---
kind: pipeline
name: build-test

platform:
  os: linux
  arch: amd64

steps:
- name: build
  image: composer
  commands:
  - composer install --prefer-dist

- name: PHPUnit Test
  image: php:7.3-rc-cli-alpine
  commands:
  - php -v
  - cp .env.example .env
  - php artisan key:generate
  - vendor/bin/phpunit --configuration phpunit.xml

- name: slack
  image: plugins/slack
  settings:
    webhook:
      from_secret: slack_webhook
    channel: classrooms-drone
  when:
  status:
  - success
  - failure

---
kind: pipeline
name: deploy
steps:
- name: Deploy to dockerhub 
  image: alpine
  commands:
    - ls -la
trigger:
  status:
  - success

depends_on:
- build-test

# trigger:
#   event:
#   - pull_request
#   - push
...
